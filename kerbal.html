<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<title>KDB.js prototype</title>
		<link rel='preload' href='backbone.js' as='script'></link>
		<style>
		#g {
			--width:  100%;
			--margin: 15px;
			--height: blue;
			margin:   var(--margin);
			width:    calc(100% - 2 * var(--margin));
			/*position: absolute;*/
			top: 0px;
			left: 0px;
		}
		elements-drag-element {
			visibility: hidden;
		}
		</style>
	</head>
	<body>
		<elements-drag-body>
			<elements-drag-element id='drag1'>
				<elements-kerbal-maker draggable='true'>
				</elements-kerbal-maker>
			</elements-drag-element>
			<elements-drag-element id='drag2'>
                <elements-kerbal-editor>
                </elements-kerbal-editor>
            </elements-drag-element>
			<elements-drag-element id='drag3'>
				<elements-kerbal-searcher draggable='true'>
				</elements-kerbal-searcher>
			</elements-drag-element>
			<elements-drag-element id='drag4'>
				<elements-kerbal-importer draggable='true'>
				</elements-kerbal-importer>
			</elements-drag-element>
		</elements-drag-body>
		KDB.js progress: <progress value='45' max='100'>0%</progress>
		<elements-grid id='g' rows='1' columns='3'>
		</elements-grid>
		<elements-kerbal-footer></elements-kerbal-footer>
	</body>
	<script src='backbone.js'></script>
	<script>
		Elements.get('drag-element', 'grid',
			'kerbal-maker', 'kerbal', 'kerbal-editor', 'KDB',
			'kerbal-searcher', 'kerbal-footer', 'kerbal-importer');
	</script>
	<script>
	{
		const test = async () => {
			await Elements.get('kerbal-searcher');
			let a = KerbalLink.get('default').getKerbal('Caltrey');
			let b = document.body.querySelector('elements-kerbal-editor');
			b.data = a;
			window.a = a;
			window.b = b;
		}
		const uiInit = async (e) => {
			await Elements.get('kerbal-link');
			KerbalLink.registerUI('default', 'maker', document.body.querySelector('#drag1').children[0]);
			KerbalLink.registerUI('default', 'editor', document.body.querySelector('#drag2').children[0]);
			KerbalLink.registerUI('default', 'searcher', document.body.querySelector('#drag3').children[0]);
			KerbalLink.registerUI('default', 'importer', document.body.querySelector('#drag4').children[0]);
		}
		const main = async (e) => {
			const revive = (string) => {return KDB.fromJSON(string);};
			await Elements.get('kerbal-link', 'KDB');
			KerbalLink.load('default', revive);
			KerbalLink.get('default').displayAll();
			uiInit(e);
		}
		window.addEventListener('load', main);
	}
	</script>
</html>
